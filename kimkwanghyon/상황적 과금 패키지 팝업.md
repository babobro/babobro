#### 상황적 과금 패키지 팝업

* 기능 설명
	* 특정 상황 시 패키지 상품 구매 팝업이 등장하고 해당 팝업을 통해 패키지 상품을 구매할 수 있음
	* 패키지 상품은 Coin과 더불어 특정 상품들이 추가 구성되어 있고 패키지 상품별로 구성을 달리 할 수 있음
* 도입 배경
	* 현 패키지 상품은 지급시까지 시간이 소요되기 때문에 유저가 필요하다고 느낄 때 해당 상품에 바로 접근할 수 없는 단점이 존재
	* 패키지 상품을 통해 직,간접적인 구매를 유도하여 고비용 상품에 대한 판매량을 늘리고자 함
* 목표
	* 일간 총 4회의 패키지 팝업 노출
		* 00:00:00 ~ 05:59:59 - 1차
		* 06:00:00 ~ 11:59:59 - 2차
		* 12:00:00 ~ 17:59:59 - 3차
		* 18:00:00 ~ 23:59:59 - 4차
	* 패키지 상품은 유저 패턴 및 조건에 따라 노출시킬 필요가 있음
		* userinfo 에 current_cash_charge 컬럼 추가
			* 유저가 최근 24시간 이내에 충전한 금액을 current_cash_charge에 추가
				* 최근 24시간 이내의 충전 금액만 추가되고 충전한지 24시간이 지난 충전 금액은 해당 컬럼에서 차감
			* 최근 24시간 이내의 **current_cash_charge = 100,000 이상** 일 경우 ** *고 과금 유저로 분류* **
			* 최근 24시간 이내의 **current_cash_charge = 50,000 이상** 일 경우 ** *중 과금 유저로 분류* **
			* 최근 24시간 이내의 **current_cash_charge = 10,000 이상** 일 경우 ** *저 과금 유저로 분류* **
			* 최근 24시간 이내의 **current_cash_charge = 0** 일 경우 ** *무 과금 유저로 분류* **
		* userinfo 에 current_item_buy_count 컬럼 추가
			* 상점 내에서 KBO 프리미엄, KBO 연도 프리미엄, KBO 포텐셜 프리미엄, 90/2000년대 와일드 카드, 강화잼(150개), 길드팩 구매시 current_item_buy_count에 카운트 추가
				* 최근 24시간 이내의 구매 내역만 카운트에 추가되고 구매한지 24시간이 지난 상품은 카운트에서 차감
			* 최근 24시간 이내의 **current_item_buy_count = 5 이상** 일 경우 ** *고 과금 유저로 분류* **
			* 최근 24시간 이내의 **current_item_buy_count = 3 이상** 일 경우 ** *중 과금 유저로 분류* **
			* 최근 24시간 이내의 **current_item_buy_count = 1 이상** 일 경우 ** *저 과금 유저로 분류* **
			* 최근 24시간 이내의 **current_item_buy_count = 0** 일 경우 ** *무 과금 유저로 분류* **
		* userinfo 에 package_condition 컬럼 추가
			* **current_cash_charge = 100,000 이상** 또는 **current_item_buy_count = 5 이상**일 경우 ** *package_condition = 1* **
			* **current_cash_charge = 50,000 이상** 또는 **current_item_buy_count = 3 이상**일 경우 ** *package_condition = 2* **
			* **current_cash_charge = 10,000 이상** 또는 **current_item_buy_count = 1 이상**일 경우 ** *package_condition = 3* **
			* **current_cash_charge = 0** 또는 **current_item_buy_count = 0**일 경우 ** *package_condition = 4* **
* 수행 방식
	* product_cash_no - 21 ~ 25 추가
	* 특정 상황 시 패키지 상품을 구매할 수 있는 팝업 창 생성(product_cash_no - 21 ~ 25 구매 가능)
		* 패키지 상품 팝업은 한번에 한개의 팝업만 띄우는 것을 원칙으로 함
		* 한개의 팝업 안에 1개의 패키지 상품이 노출
		* 팝업 하단의 ** 오늘 하루 보지 않기 ** 버튼을 눌렀을 경우 하루 동안 상황적 과금 패키지 팝업이 노출되지 않음
	* 팝업창 구매 페이지 이동을 통해 각 마켓의 상품 구매
	* 상품 구매 후 유저가 받는 리턴 값(21 ~ 25)에 따라 DB 패키지 보상 테이블에 설정된 아이템을 선물함으로 즉시 지급
	* userinfo 테이블에 ** *current_cash_charge* **, ** *current_item_buy_count* **, ** *package_condition* ** 컬럼 추가
|user_no|user_device_CTN|user_device_ID|user_flag|team_name|team_no|legue_no|point|cash|ipt_time|upt_time|max_card_count|current_card_count|team_color_slot1|team_color_slot2|team_color_slot3|team_color_slot4|sum_card_cost|team_color_slot5|team_color_slot6|current_staffcard_count|** *current_cash_charge* **|** *current_item_buy_count* **|** *package_condition* **|
|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
|201404040000000000|01092233614|351932063472533|0|팀명|7|1|123123|343400|0000-00-00 00:00:00|0000-00-00 00:00:00|400|392|11746|11726|11706|10206|165|12310|12110|194|** *145000* **|** *3* **|** *1* **|
	* product_cash_no 에 따른 캐시 상품 테이블(** *[shop].[PRODUCT_CASH]* **) 구성
|product_cash_no|product_name|product_cose|product_reward|open_tag|product_intro|ipt_time|upt_time|sort_no|image_no|
|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|
|21|코인더미 패키지|5000|5500|Y|5000원 패키지 상품|0000-00-00 00:00:00|0000-00-00 00:00:00|21|1|
|22|코인자루 패키지|10000|11500|Y|10000원 패키지 상품|0000-00-00 00:00:00|0000-00-00 00:00:00|22|2|
|23|코인상자 패키지|30000|37500|Y|30000원 패키지 상품|0000-00-00 00:00:00|0000-00-00 00:00:00|23|3|
|24|코인금고 패키지|50000|68000|Y|50000원 패키지 상품|0000-00-00 00:00:00|0000-00-00 00:00:00|24|4|
|25|코인트럭 패키지|100000|145000|Y|100000원 패키지 상품|0000-00-00 00:00:00|0000-00-00 00:00:00|25|5|
	* product_cash_no 에 따른 추가 상품 테이블(** *[shop].[PRODUCT_CASH_PACKAGE]* **) 구성
|product_cash_no|product_name|item_reward1|item_reward1_count|item_reward2|item_reward2_count|item_reward3|item_reward3_count|item_reward4|item_reward4_count|item_reward5|item_reward5_count|
|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|
|21|코인더미 패키지|90901|1|0|0|0|0|0|0|0|0|
|22|코인자루 패키지|90901|1|90902|1|0|0|0|0|0|0|
|23|코인상자 패키지|90901|2|90902|2|90903|1|0|0|0|0|
|24|코인금고 패키지|90901|2|90902|2|90903|1|90904|2|0|0|
|25|코인트럭 패키지|90901|2|90902|2|90903|1|90904|2|90905|2|

		* DB 보상 테이블 구성 필요
		* 구매 관련 통신시 주고받는 값에 대한 정의 필요
		* product_cash_no = 21 ~ 25 패키지 상품 구매에 따른 리워드 아이템 자동 지급 프로토콜 구성 필요
		* 구성 상품의 변경이 가능하도록 시뮬레이션 툴에서 변경이 가능하도록 개발 필요
			* CDN 및 추가 상품 테이블 변경이 필요하므로 서버 재시작을 염두에 두고 개발

* 클라이언트 요청 사항
		* 유저 분류
			* package_condition = 1 (고과금 유저)
			* package_condition = 2 (중과금 유저)
			* package_condition = 3 (저과금 유저)
			* package_condition = 4 (무과금 유저)
		* 분류 근거
			* userinfo에 저장된 package_condition 값을 받아 유저 분류
		* 팝업 노출 방법
			* 최초 게임 접속 시 DB에서 해당 유저의 package_condition 값을 전달 받음
			* 정해진 팝업 시간 대에 팝업이 노출되었는지 여부 파악
				* 00:00:00 ~ 05:59:59 - 1차
				* 06:00:00 ~ 11:59:59 - 2차
				* 12:00:00 ~ 17:59:59 - 3차
				* 18:00:00 ~ 23:59:59 - 4차
			* 해당 시간의 팝업이 노출되지 않았을 경우 package_condition 값에 따라 패키지 상품 팝업 확률 테이블을 참조하여 팝업 노출
			* 오늘 하루 보지 않기 버튼을 활성화 하였을 경우 해당 일자의 팝업은 모두 노출되지 않음
	* 패키지 상품 팝업 확률 테이블
|유저 분류|21번 상품 노출 확률|22번 상품 노출 확률|23번 상품 노출 확률|24번 상품 노출 확률|25번 상품 노출 확률|
|:------:|:------:|:------:|:------:|:------:|:------:|
|1|0|500|1000|3000|5500|
|2|0|500|1500|5000|3000|
|3|2000|2000|1000|2500|2500|
|4|3000|1500|1500|3000|1000|
	* 메인 화면 진입 시 확률에 따라 1개의 패키지 상품 팝업이 노출
		* 일간 총 4회 노출 가능
		* 매 호출시 마다 패키지 상품 노출 확률에 따라 노출
			* 00:00:00 ~ 05:59:59 - 1차
			* 06:00:00 ~ 11:59:59 - 2차
			* 12:00:00 ~ 17:59:59 - 3차
			* 18:00:00 ~ 23:59:59 - 4차
		* 오늘 하루 보지 않기 활성화를 할 경우 현시간 이후의 금일 팝업은 모두 노출되지 않음
	* 팝업 메인이미지는 변경이 없으나 패키지 별 이미지는 변경이 필요하므로 CDN을 통해 다운로드 받을 수 있도록 하여 패키지 상품 리소스를 관리

* 필요 디자인 리소스
	* 팝업 메인 이미지 필요
	* 각 패키지 별 이미지 필요